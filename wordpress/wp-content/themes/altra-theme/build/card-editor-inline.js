(()=>{"use strict";var t,e={517:()=>{class t{constructor(){this.isActive=!1,this.editedCards=new Map,this.init()}init(){this.createToggleButton(),this.createSaveButton()}createToggleButton(){const t=document.createElement("button");t.id="altra-card-editor-toggle",t.className="altra-fixed-button",t.innerHTML='\n\t\t\t<span class="dashicons dashicons-admin-customizer"></span>\n\t\t\t<span class="button-text">Edit Cards</span>\n\t\t',t.addEventListener("click",()=>this.toggle()),document.body.appendChild(t)}createSaveButton(){const t=document.createElement("button");t.id="altra-card-editor-save",t.className="altra-fixed-button altra-save-button",t.innerHTML='\n\t\t\t<span class="dashicons dashicons-yes"></span>\n\t\t\t<span class="button-text">Save All</span>\n\t\t',t.style.display="none",t.addEventListener("click",()=>this.saveAll()),document.body.appendChild(t)}toggle(){this.isActive=!this.isActive,document.body.classList.toggle("altra-card-edit-mode",this.isActive),this.isActive?this.activate():this.deactivate()}activate(){document.querySelectorAll(".project-card").forEach(t=>{this.makeCardEditable(t)}),document.querySelectorAll(".project-link").forEach(t=>{t.addEventListener("click",this.preventClick)}),document.getElementById("altra-card-editor-save").style.display="flex"}deactivate(){document.querySelectorAll(".card-edit-overlay").forEach(t=>t.remove()),document.querySelectorAll(".zoom-control-inline").forEach(t=>t.remove()),document.querySelectorAll(".project-link").forEach(t=>{t.removeEventListener("click",this.preventClick)}),document.getElementById("altra-card-editor-save").style.display="none"}preventClick(t){t.preventDefault(),t.stopPropagation()}makeCardEditable(t){const e=t.dataset.projectId,a=t.querySelector(".project-image"),o=a.querySelector("img");if(!o)return;const s=document.createElement("div");s.className="card-edit-overlay",s.innerHTML='\n\t\t\t<div class="edit-controls">\n\t\t\t\t<div class="edit-hint">Alt + Click to set focal point</div>\n\t\t\t\t<div class="focal-point-picker">\n\t\t\t\t\t<div class="focal-point-crosshair"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t',a.appendChild(s);const n=t.querySelector(".project-info"),r=document.createElement("div");r.className="zoom-control-inline",r.innerHTML=`\n\t\t\t<label>Zoom</label>\n\t\t\t<input type="range" min="0.5" max="2.5" step="0.01" value="${t.dataset.zoom}" class="zoom-slider">\n\t\t\t<span class="zoom-value">${parseFloat(t.dataset.zoom).toFixed(2)}x</span>\n\t\t`,n.appendChild(r);const i=s.querySelector(".focal-point-picker"),l=s.querySelector(".focal-point-crosshair");this.updateCrosshairPosition(l,t.dataset.focalX,t.dataset.focalY),i.addEventListener("click",a=>{if(!a.altKey)return;a.preventDefault(),a.stopPropagation();const s=i.getBoundingClientRect(),n=(a.clientX-s.left)/s.width*100,r=(a.clientY-s.top)/s.height*100;this.updateFocalPoint(t,o,n,r),this.updateCrosshairPosition(l,n,r),this.trackChange(e,t)});const c=r.querySelector(".zoom-slider"),d=r.querySelector(".zoom-value");c.addEventListener("input",a=>{const s=parseFloat(a.target.value);this.updateZoom(t,o,s),d.textContent=s.toFixed(2)+"x",this.trackChange(e,t)})}updateCrosshairPosition(t,e,a){t.style.left=e+"%",t.style.top=a+"%"}updateFocalPoint(t,e,a,o){t.dataset.focalX=a,t.dataset.focalY=o,e.style.transformOrigin=`${a}% ${o}%`}updateZoom(t,e,a){t.dataset.zoom=a;const o=e.style.transform||"",s=/scale\([^)]+\)/;s.test(o)?e.style.transform=o.replace(s,`scale(${a})`):e.style.transform=`scale(${a})`}trackChange(t,e){this.editedCards.set(parseInt(t),{focalPoint:{x:parseFloat(e.dataset.focalX),y:parseFloat(e.dataset.focalY)},zoom:parseFloat(e.dataset.zoom)})}async saveAll(){if(0===this.editedCards.size)return void alert("No changes to save");const t=document.getElementById("altra-card-editor-save");t.disabled=!0,t.querySelector(".button-text").textContent="Saving...";const e=[];for(const[t,a]of this.editedCards.entries()){const o=fetch(`/wp-json/altra/v1/project/${t}/visual-settings`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.altraCardEditorData?.nonce||""},body:JSON.stringify({visualSettings:{focalPoint:a.focalPoint,zoom:a.zoom,textLayers:[]}})});e.push(o)}try{await Promise.all(e),alert(`Successfully saved ${this.editedCards.size} card(s)!`),this.editedCards.clear(),window.location.reload()}catch(e){console.error("Save error:",e),alert("Failed to save some changes. Please try again."),t.disabled=!1,t.querySelector(".button-text").textContent="Save All"}}}document.addEventListener("DOMContentLoaded",()=>{window.altraCardEditorData&&new t})}},a={};function o(t){var s=a[t];if(void 0!==s)return s.exports;var n=a[t]={exports:{}};return e[t](n,n.exports,o),n.exports}o.m=e,t=[],o.O=(e,a,s,n)=>{if(!a){var r=1/0;for(d=0;d<t.length;d++){for(var[a,s,n]=t[d],i=!0,l=0;l<a.length;l++)(!1&n||r>=n)&&Object.keys(o.O).every(t=>o.O[t](a[l]))?a.splice(l--,1):(i=!1,n<r&&(r=n));if(i){t.splice(d--,1);var c=s();void 0!==c&&(e=c)}}return e}n=n||0;for(var d=t.length;d>0&&t[d-1][2]>n;d--)t[d]=t[d-1];t[d]=[a,s,n]},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={577:0,744:0};o.O.j=e=>0===t[e];var e=(e,a)=>{var s,n,[r,i,l]=a,c=0;if(r.some(e=>0!==t[e])){for(s in i)o.o(i,s)&&(o.m[s]=i[s]);if(l)var d=l(o)}for(e&&e(a);c<r.length;c++)n=r[c],o.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return o.O(d)},a=globalThis.webpackChunkaltra_theme=globalThis.webpackChunkaltra_theme||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))})();var s=o.O(void 0,[744],()=>o(517));s=o.O(s)})();